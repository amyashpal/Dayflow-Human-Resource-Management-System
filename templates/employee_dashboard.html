{% extends "base.html" %}

{% block title %}Dashboard - Dayflow HRMS{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="fas fa-tachometer-alt"></i> Welcome, {{ current_user.first_name }}!</h2>
        <p class="text-muted">{{ current_user.login_id }} | {{ current_user.department or 'No Department' }}</p>
    </div>
    <div class="btn-group" role="group">
        {% if not attendance or not attendance.check_in %}
            <button type="button" class="btn btn-success" onclick="checkIn()">
                <i class="fas fa-sign-in-alt"></i> Check In
            </button>
        {% elif not attendance.check_out %}
            <button type="button" class="btn btn-warning" onclick="checkOut()">
                <i class="fas fa-sign-out-alt"></i> Check Out
            </button>
        {% else %}
            <span class="btn btn-outline-secondary disabled">
                <i class="fas fa-check"></i> Day Complete
            </span>
        {% endif %}
    </div>
</div>

<!-- Quick Access Cards -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card h-100 text-center quick-access-card" onclick="window.location.href='{{ url_for('profile') }}'">
            <div class="card-body">
                <i class="fas fa-user fa-2x mb-3"></i>
                <h6 class="card-title">Profile</h6>
                <p class="card-text small text-muted">View and edit your profile information</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card h-100 text-center quick-access-card" onclick="window.location.href='{{ url_for('attendance') }}'">
            <div class="card-body">
                <i class="fas fa-clock fa-2x mb-3"></i>
                <h6 class="card-title">Attendance</h6>
                <p class="card-text small text-muted">Track your daily attendance records</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card h-100 text-center quick-access-card" onclick="window.location.href='{{ url_for('time_off') }}'">
            <div class="card-body">
                <i class="fas fa-calendar-alt fa-2x mb-3"></i>
                <h6 class="card-title">Leave Requests</h6>
                <p class="card-text small text-muted">Apply for time off and track requests</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card h-100 text-center quick-access-card" onclick="window.location.href='{{ url_for('salary') }}'">
            <div class="card-body">
                <i class="fas fa-money-bill-wave fa-2x mb-3"></i>
                <h6 class="card-title">Salary</h6>
                <p class="card-text small text-muted">View your salary details and structure</p>
            </div>
        </div>
    </div>
</div>

<!-- Today's Status -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-calendar-day"></i> Today's Status</h5>
            </div>
            <div class="card-body">
                {% if attendance %}
                    <div class="row">
                        <div class="col-6">
                            <strong>Check In:</strong><br>
                            {% if attendance.check_in %}
                                <span class="text-success">{{ attendance.check_in.strftime('%I:%M %p') }}</span>
                            {% else %}
                                <span class="text-muted">Not checked in</span>
                            {% endif %}
                        </div>
                        <div class="col-6">
                            <strong>Check Out:</strong><br>
                            {% if attendance.check_out %}
                                <span class="text-info">{{ attendance.check_out.strftime('%I:%M %p') }}</span>
                            {% else %}
                                <span class="text-muted">Not checked out</span>
                            {% endif %}
                        </div>
                    </div>
                    {% if attendance.hours_worked > 0 %}
                        <hr>
                        <strong>Hours Worked:</strong> {{ "%.2f"|format(attendance.hours_worked) }} hours
                    {% endif %}
                {% else %}
                    <p class="text-muted">No attendance record for today</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-history"></i> Recent Leave Requests</h5>
            </div>
            <div class="card-body">
                {% if recent_leaves %}
                    {% for leave in recent_leaves %}
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div>
                                <strong>{{ leave.leave_type.title() }} Leave</strong><br>
                                <small class="text-muted">{{ leave.start_date.strftime('%b %d') }} - {{ leave.end_date.strftime('%b %d, %Y') }}</small>
                            </div>
                            <span class="badge bg-{{ 'success' if leave.status == 'approved' else 'danger' if leave.status == 'rejected' else 'warning' }}">
                                {{ leave.status.title() }}
                            </span>
                        </div>
                        {% if not loop.last %}<hr>{% endif %}
                    {% endfor %}
                {% else %}
                    <p class="text-muted">No recent leave requests</p>
                {% endif %}
                
                <div class="text-center mt-3">
                    <a href="{{ url_for('apply_leave') }}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-plus"></i> Apply for Leave
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function checkIn() {
    $.post('{{ url_for("check_in") }}', function(data) {
        if (data.success) {
            location.reload();
        } else {
            alert(data.message);
        }
    });
}

function checkOut() {
    $.post('{{ url_for("check_out") }}', function(data) {
        if (data.success) {
            location.reload();
        } else {
            alert(data.message);
        }
    });
}
</script>
{% endblock %}